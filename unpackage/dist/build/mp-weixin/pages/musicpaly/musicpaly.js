(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/musicpaly/musicpaly"],{"21e5":function(t,i,e){"use strict";(function(t,i){var n=e("4ea4");e("fd4b");n(e("66fd"));var s=n(e("b144"));t.__webpack_require_UNI_MP_PLUGIN__=e,i(s.default)}).call(this,e("bc2e")["default"],e("543d")["createPage"])},"47b6":function(t,i,e){"use strict";e.r(i);var n=e("f140"),s=e.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){e.d(i,t,(function(){return n[t]}))}(r);i["default"]=s.a},"60db":function(t,i,e){},"7b98":function(t,i,e){"use strict";e.d(i,"b",(function(){return n})),e.d(i,"c",(function(){return s})),e.d(i,"a",(function(){}));var n=function(){var t=this.$createElement;this._self._c},s=[]},a604:function(t,i,e){"use strict";var n=e("60db"),s=e.n(n);s.a},b144:function(t,i,e){"use strict";e.r(i);var n=e("7b98"),s=e("47b6");for(var r in s)["default"].indexOf(r)<0&&function(t){e.d(i,t,(function(){return s[t]}))}(r);e("a604");var u=e("f0c5"),o=Object(u["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);i["default"]=o.exports},f140:function(t,i,e){"use strict";(function(t){var n=e("4ea4");Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=n(e("2eee")),r=n(e("c973")),u=e("b8bb"),o=n(e("349c")),c={data:function(){return{issxbf:!0,bfq:{jsq:0,sildermax:1e3,start:0,jdt:0,time:0,txt:0,isbf:!1,xhbf:!1},innerAudioContext:null,srctop:0,contentScrollW:0,current:{articleContent:null,audioLink:"",author:"1",briefIntro:null,createBy:"",createTime:"2024-03-14 21:30:05",displayOrder:1,freeListenDuration:0,imageGallery:null,likeCount:0,musicCategory:"闽南语歌",musicCunchu:"http://djlmy.top:8080/profile/upload/2024/03/14/音频_20240314212950A010.mp3",musicId:4,price:1,qrCode:"",remark:null,thumbnail:"http://djlmy.top:8080/profile/upload/2024/03/14/bz_20240314212930A009.png",title:"test",updateBy:"",updateTime:null,viewCount:0,virtualPayCount:1,wechatId:""},muisclist:[],audioAction:{method:"pause"},ip:o.default.url,lrc:[]}},methods:{setxhbff:function(){this.bfq.xhbf=!this.bfq.xhbf,this.bfq.xhbf?this.innerAudioContext.loop=!0:this.innerAudioContext.loop=!1},bofang:function(){this.bfq.isbf=!this.bfq.isbf,this.bfq.isbf?this.musicplay():this.musicstop()},settop:function(){var i=this,e=t.createSelectorQuery().in(this);e.select(".content-scroll").boundingClientRect((function(t){i.contentScrollW=t.height})).exec(),this.issxbf=!0,setTimeout((function(){console.log("长度",i.lrc.length),e.selectAll(".scroll-item").boundingClientRect((function(t){var e=t.length;console.log("执行内",t);for(var n=0;n<e;n++)i.srctop=0,i.lrc[n].top=t[n].top,1==n&&console.log(t[n].top),0==t[n].height&&console.log(i.lrc[n]),i.lrc[n].height=t[n].height,i.bfq.txt=0})).exec()}),100),console.log("执行",this.lrc)},utiltime:function(t){this.lrc=this.lrc.map((function(t){var i=t.time,e=i.split(":"),n=parseInt(e[0]),s=e[1].split("."),r=parseInt(s[0]),u=(parseFloat(s[1]),60*n+r);return t.time=u,/^\s*$/.test(t.text)&&(t.text="无歌词"),t}))},soutext:function(){var t=this;this.lrc.forEach((function(i,e){if(i.time==Math.floor(t.bfq.time)){if(e<5)return;return t.bfq.txt=e,void(i.top-t.contentScrollW/2>0&&(t.srctop=i.top-t.contentScrollW/2,console.log("长度",i.top)))}}))},musicplay:function(t){this.innerAudioContext.src=this.ip+this.current.musicCunchu,this.innerAudioContext.play(),this.setout()},musicchage:function(t){this.bfq.jdt=t.detail.value;this.innerAudioContext.duration,this.innerAudioContext.currentTime,this.bfq.sildermax;this.innerAudioContext.seek(Math.floor(this.bfq.jdt*this.innerAudioContext.duration/this.bfq.sildermax)),this.soutext(),this.setout()},musicstop:function(t){this.innerAudioContext.pause(),clearInterval(this.bfq.jsq)},muiscchang:function(t){clearInterval(this.bfq.jsq)},setout:function(){var t=this;clearInterval(this.bfq.jsq),this.bfq.jsq=setInterval((function(){1e3===t.bfq.jdt&&clearInterval(t.bfq.jsq);var i=t.innerAudioContext.duration,e=t.innerAudioContext.currentTime*t.bfq.sildermax;t.bfq.jdt=Math.floor(e/i),t.bfq.time=t.bfq.jdt*i/t.bfq.sildermax,t.soutext()}),200)},setdata:function(t){var i=this;return(0,r.default)(s.default.mark((function e(){var n,r,o,c;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,u.muiscapi)();case 2:return i.muisclist=e.sent.rows,e.next=5,(0,u.getmuisc)(t);case 5:return i.current=e.sent.data,e.prev=6,e.next=9,(0,u.musiczim)(t);case 9:n=e.sent,r=n.trim(),o=r.substring(1,r.length-1),c=o.replace(/([{,]\s*)([a-zA-Z0-9_]+?)\s*:/g,'$1"$2":'),i.lrc=JSON.parse("["+c+"]"),0!==i.lrc.length&&setTimeout((function(){i.utiltime(),i.settop()}),100),e.next=20;break;case 17:return e.prev=17,e.t0=e["catch"](6),e.abrupt("return");case 20:case"end":return e.stop()}}),e,null,[[6,17]])})))()},muiscdowl:function(){var t=this;this.musicstop(),this.muisclist.some((function(i,e){if(t.current.musicId==i.musicId){var n=t.muisclist.length;return t.current=e+1==n?t.muisclist[0]:t.muisclist[e+1],t.xycs(),!0}})),this.musicplay(),this.bfq.isbf=!0},xycs:function(){var t=this,i=this.current.articleContent,e=i.trim(),n=e.substring(1,e.length-1),s=n.replace(/([{,]\s*)([a-zA-Z0-9_]+?)\s*:/g,'$1"$2":');this.lrc=JSON.parse("["+s+"]"),this.issxbf=!1,setTimeout((function(){t.utiltime(),t.settop()}),100)},muiscup:function(){var t=this;this.musicstop(),this.muisclist.some((function(i,e){if(t.current.musicId==i.musicId){var n=t.muisclist.length;return t.current=e-1==-1?t.muisclist[n-1]:t.muisclist[e-1],console.log(t.current.musicId),t.xycs(),!0}})),this.musicplay(),this.bfq.isbf=!0}},computed:{time:function(){var t=this.bfq.time,i=0|Math.floor(t/60),e=t%60|0,n=("0"+i).slice(-2)+":"+("0"+e).slice(-2);return n}},mounted:function(){this.setout(),this.settop(),this.utiltime()},onLoad:function(i){var e=this;this.innerAudioContext=t.createInnerAudioContext(),this.setdata(i.id),this.innerAudioContext.onEnded((function(){e.bfq.xhbf||e.muiscdowl()}))},beforeDestroy:function(){this.musicstop()}};i.default=c}).call(this,e("543d")["default"])}},[["21e5","common/runtime","common/vendor"]]]);